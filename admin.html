<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</title>
  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, sans-serif; 
      margin: 2rem; 
      background: #f8f9fa;
    }
    h1 { color: #2c3e50; }
    table { 
      width: 100%; 
      border-collapse: collapse; 
      margin-top: 1.5rem; 
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    th, td { 
      border: 1px solid #dee2e6; 
      padding: 1rem; 
      text-align: right; 
    }
    th { 
      background: #007bff; 
      color: white; 
      font-weight: bold;
    }
    tr:nth-child(even) { background: #f2f7ff; }
    tr:hover { background: #e9f2ff; }
    code { 
      background: #eee; 
      padding: 0.2rem 0.4rem; 
      border-radius: 3px; 
      font-family: monospace;
      font-size: 0.9em;
    }
    .status { 
      display: inline-block;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: bold;
    }
    .status.connected { background: #d4edda; color: #155724; }
    .status.disconnected { background: #f8d7da; color: #721c24; }
    .timestamp { 
      color: #6c757d; 
      font-size: 0.85em;
      white-space: nowrap;
    }
    #statusBar {
      margin-bottom: 1.5rem;
      padding: 0.8rem;
      border-radius: 6px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€” Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h1>
  
  <div id="statusBar" class="status disconnected">ğŸ”´ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>

  <table>
    <thead>
      <tr>
        <th>Ø§Ù„Ù…Ø¹Ø±Ù</th>
        <th>Ø§Ù„Ø§Ø³Ù…</th>
        <th>Ø§Ù„Ø¬ÙˆØ§Ù„</th>
        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
        <th>Ø§Ù„ÙˆÙ‚Øª</th>
        <th>Ø§Ù„Ø£Ø´Ø®Ø§Øµ</th>
        <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
        <th>ÙˆÙ‚Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</th>
      </tr>
    </thead>
    <tbody id="bookingsList">
      <tr><td colspan="8" style="text-align:center; padding:1.5rem;">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
    </tbody>
  </table>

  <!-- ğŸ”¥ Firebase SDK (Ù…ÙØ­Ø¯Ù‘Ø« â€” Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª Ø²Ø§Ø¦Ø¯Ø©) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <script>
    // âœ… Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ table-booking-5d9d4 (Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª ÙÙŠ databaseURL)
    const firebaseConfig = {
      apiKey: "AIzaSyAnH3AczYq13NMVA18BhucGzeffEuC5QIM",
      authDomain: "table-booking-5d9d4.firebaseapp.com",
      databaseURL: "https://table-booking-5d9d4-default-rtdb.firebaseio.com", // âœ… Ù…Ø³Ø§ÙØ§Øª Ù…ÙØ²Ø§Ù„Ø©
      projectId: "table-booking-5d9d4",
      storageBucket: "table-booking-5d9d4.firebasestorage.app",
      messagingSenderId: "1097720872360",
      appId: "1:1097720872360:web:b8d94656b7440b4353719d"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ğŸ‘‡ Ù…Ø¤Ø´Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
    const statusDiv = document.getElementById('statusBar');
    db.ref('.info/connected').on('value', (snap) => {
      if (snap.val()) {
        statusDiv.className = "status connected";
        statusDiv.innerHTML = "ğŸŸ¢ Ù…ØªØµÙ„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª â€” Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¢Ù†ÙŠ";
      } else {
        statusDiv.className = "status disconnected";
        statusDiv.innerHTML = "ğŸ”´ Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ â€” ÙŠÙØ¹Ø§Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§";
      }
    });

    // ğŸ‘‡ Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª (Ù…Ø±ØªØ¨Ø© Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…)
    const bookingsList = document.getElementById('bookingsList');

    db.ref('bookings')
      .orderByChild('timestamp')
      .on('value', (snapshot) => {
        bookingsList.innerHTML = '';

        if (snapshot.exists()) {
          const bookings = [];
          snapshot.forEach((child) => {
            bookings.push(child.val());
          });

          // Ø¹ÙƒØ³ Ø§Ù„ØªØ±ØªÙŠØ¨: Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ù‹Ø§
          bookings.reverse().forEach((b) => {
            const timestamp = b.timestamp || Date.now();
            const dateObj = new Date(timestamp);
            const timeStr = dateObj.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
            const dateStr = dateObj.toLocaleDateString('ar-SA');

            const row = document.createElement('tr');
            row.innerHTML = `
              <td><code>${(b.id || '').substring(0,6) || '---'}</code></td>
              <td>${b.name || 'â€”'}</td>
              <td dir="ltr">+${b.phone || 'â€”'}</td>
              <td>${b.dateDisplay || b.date || 'â€”'}</td>
              <td>${b.time || 'â€”'}</td>
              <td>${b.guests || 'â€”'}</td>
              <td>${b.notes.length > 30 ? b.notes.substring(0,30)+'...' : b.notes || 'â€”'}</td>
              <td class="timestamp">${timeStr} <br> ${dateStr}</td>
            `;
            bookingsList.appendChild(row);
          });
        } else {
          bookingsList.innerHTML = `
            <tr>
              <td colspan="8" style="text-align:center; padding:2rem; color:#6c757d;">
                Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ø¨Ø¹Ø¯.<br>
                <small>Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ø­Ø¬Ø² Ù‡Ù†Ø§ ÙÙˆØ± Ø¥Ø±Ø³Ø§Ù„Ù‡ Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ø­Ø¬Ø².</small>
              </td>
            </tr>`;
        }
      });
  </script>
</body>
</html>